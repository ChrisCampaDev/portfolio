---
import { getTexts, getLocaleFromAstro } from "@/utils/i18n";
import EsFlag from "@/components/ui/icons/flags/es.astro";
import EnFlag from "@/components/ui/icons/flags/en.astro";

const t = getTexts(Astro);
const locale = getLocaleFromAstro(Astro);
const isEN = locale === 'en';
const { pathname, hash } = Astro.url;

function buildSwitchHref(targetLocale: 'es' | 'en') {
  const segs = pathname.split('/').filter(Boolean);
  const base = segs[0] ?? '';
  const hasLocale = segs[1] === 'en';
  const rest = hasLocale ? segs.slice(2) : segs.slice(1);
  const newSegs = targetLocale === 'en' ? [base, 'en', ...rest] : [base, ...rest];
  const newPath = '/' + newSegs.filter(Boolean).join('/') + (pathname.endsWith('/') ? '/' : '');
  return newPath + (hash || '');
}

const switchLocale = isEN ? 'es' : 'en';
const switchHref = buildSwitchHref(switchLocale);
const switchLabel = t.nav.switch;
const TargetFlag = isEN ? EsFlag : EnFlag;
const flagTitle = switchLocale === 'es' ? 'Espa√±ol' : 'English';
---

<footer class="border-t border-border/60 bg-stone-900">
    <div class="w-full max-w-screen-xl mx-auto px-4 py-8 md:py-10">
        <div class="flex items-start justify-between gap-4 flex-col md:flex-row">
            <p class="text-white/90 md:max-w-3xl">{t.footer.description}</p>
            <a href={switchHref} class="self-start inline-flex items-center gap-2 px-3 py-1 rounded-md border border-white/40 hover:bg-white/10 text-white transition" aria-label={`Switch language to ${switchLabel}`}>
                {switchLabel}
                <TargetFlag width={20} height={15} class="w-5 h-[15px]" title={flagTitle} />
            </a>
        </div>
        <hr class="my-6 sm:mx-auto border-border/60 lg:my-8" />
        <span class="block text-center text-xs text-white">{new Date().getFullYear()} <a href="https://github.com/ChrisCampaDev" class="underline-offset-4 hover:underline text-white">ChrisCampaDev</a>. {t.footer.rights}</span>
    </div>
</footer>
